version: 2.1

jobs:
  test:
    docker:
      - image: circleci/python:3.7-buster
    steps:
      - run:
          name: Install dependencies
          command: |
            sudo apt-get update
            sudo apt-get install -y gnupg2 python3-pyqt5 tor xvfb
      - run:
          name: Start tor service
          command: sudo service tor start
      - checkout
      - run:
          name: Install python dependencies
          command: pipenv install --dev
      - run:
          name: Run tests
          command: pipenv run xvfb-run -s "-screen 0 1280x1024x24" python setup.py pytest

workflows:
  version: 2
  test:
    jobs:
      - test
